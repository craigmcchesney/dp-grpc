syntax = "proto3";

option java_multiple_files = true;
option java_package = "com.ospreydcs.dp.grpc.v1.query";

import "common.proto";

service DpQueryService {
  rpc query(QueryRequest) returns (stream QueryResponse);
}

message QueryRequest {
  Timestamp startTime = 1;
  Timestamp endTime = 2;
  repeated string columnNames = 3;
}

message QueryResponse {

  ResponseType responseType = 1;
  Timestamp responseTime = 2;

  oneof response {
    QueryResult queryResult = 10;
    RejectDetails rejectDetails = 11;
  }

  message QueryResult {

    oneof resultMessage {
      ResultSummary resultSummary = 1;
      ResultData resultData = 2;
    }

    message ResultSummary {
      bool isError = 1;
      string message = 2;
      uint32 numBuckets = 3;
    }

    message ResultData {
      repeated DataBucket dataBuckets = 1;
    }

    message DataBucket {
      FixedIntervalTimestampSpec samplingInterval = 1;
      repeated Attribute attributes = 2;
      EventMetadata eventMetadata = 3;
      DataColumn dataColumn = 4;
    }
  }
}

